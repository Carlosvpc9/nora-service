<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <title>{{appTitle}} - Login</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet"
          href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
          integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
          crossorigin="anonymous" />

    <link type="text/css" rel="stylesheet" href="/module/firebaseui/dist/firebaseui.css" />

    <script src="{{fireBase.jsBaseUrl}}/firebase-app.js"></script>
    <script src="{{fireBase.jsBaseUrl}}/firebase-auth.js"></script>

    <script src="{{fireBase.remoteInitUrl}}"></script>

    <script src="/module/firebaseui/dist/firebaseui.js"></script>

    <script>
        var uiConfig = {
            signInOptions: [
                firebase.auth.GoogleAuthProvider.PROVIDER_ID,
                // firebase.auth.FacebookAuthProvider.PROVIDER_ID,
                // firebase.auth.TwitterAuthProvider.PROVIDER_ID,
                firebase.auth.GithubAuthProvider.PROVIDER_ID,
                // firebase.auth.EmailAuthProvider.PROVIDER_ID,
                // firebase.auth.PhoneAuthProvider.PROVIDER_ID,
                // firebaseui.auth.AnonymousAuthProvider.PROVIDER_ID
            ],
	        // tosUrl and privacyPolicyUrl accept either url string or a callback
            // function.
            // Terms of service url/callback.
            tosUrl: function() {
              window.location.assign('/terms');
            },
            // Privacy policy url/callback.
            privacyPolicyUrl: function() {
              window.location.assign('/privacy');
            },
            callbacks: {
                signInSuccessWithAuthResult: function (authResult, redirectUrl) {
                    authResult.user.getIdToken().then(function (token) {
                        document.getElementById('inputToken').value = token;
                        document.forms.loginForm.submit();
                    });
                    return false;
                },
            }
        };
        var ui = new firebaseui.auth.AuthUI(firebase.auth());
        ui.start('#firebaseui-auth-container', uiConfig);
    </script>
</head>

<body class="text-center p-3" style="background-color:#f5f5f5">
    <div class="container card mt-5 pb-3 pt-4" style="max-width: 450px; text-align:left">
        <p>
            Recent issues with NORA availability have been caused by the high number of online users reaching over 2400
            at any time. Unfortunately the current implementation and the existing free Heroku instance can not handle
            this kind of load.
        </p>

        <p>
            I'm currently working on a new (<a href="https://smart-nora.eu/">Smart NORA</a>) version that will be backed
            by Firebase and will be able to handle tens of thousands of concurrent users without a problem. It will also
            come with a new set of features (support for new devices/traits, local execution, 2FA, push notifications,
            ESP library for direct device support).
        </p>
	    
	<p>
            If you want to join the alpha testers, feel free to join the Smart NORA slack workspace: <a href="https://join.slack.com/t/smart-nora/shared_invite/zt-m1vy0jfq-j7JrN85waaqw~l8LY5naSg">https://join.slack.com/t/smart-nora/shared_invite/zt-m1vy0jfq-j7JrN85waaqw~l8LY5naSg</a>
	</p>

        <p>
            Being a big project hosted in the cloud, it will eventually require a subscription (probably around 2-3
            eur/month) but it will always offer a free account type (probably with a limit on the number of devices).
        </p>

        <p>
            The current status of the new project (<a href="https://smart-nora.eu/">Smart NORA</a>) is in alpha testing.
            It already supports all the current NORA features +
            local execution and 2FA. Currently waiting for approval from Google and it will be released into wide beta
            testing. Once available to the public it will be free for use for a few months.
        </p>

        <p>
            I have no plans on developing the current version of NORA any further but also, no plans to bring it down.
        </p>
    </div>
    <div class="container card mt-3 pb-3 pt-4" style="max-width: 450px">
        <form id="loginForm" method="post" action="/login{{query}}">
            <h1 class="h3 mb-3 font-weight-normal">
                <strong>NO</strong>de-<strong>R</strong>ed home <strong>A</strong>utomation
	        </h1>
            <h1 class="h4 mb-3 font-weight-normal">Select sign in method</h1>
            <input type="hidden" id="inputToken" name="token" />
            <div id="firebaseui-auth-container"></div>
        </form>
    </div>
</body>

</html>
